



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.5.14">
    
    
      
        <title>03 Formation Scolytes - fordead</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d3202873.min.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ff0a5ce4.min.css">
      
      
        
        
        <meta name="theme-color" content="#4cae4f">
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../style.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="green" data-md-color-accent="lightgreen">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#detection-des-foyers-de-mortalite-dans-les-massifs-de-coniferes-par-imagerie-satellite-sentinel-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="fordead" class="md-header-nav__button md-logo" aria-label="fordead">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            fordead
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              03 Formation Scolytes
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://gitlab.com/raphael.dutrieux/fordead_package/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fordead_package
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="fordead" class="md-nav__button md-logo" aria-label="fordead">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    fordead
  </label>
  
    <div class="md-nav__source">
      
<a href="https://gitlab.com/raphael.dutrieux/fordead_package/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fordead_package
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../00_Intro_Objectifs/" title="00 Intro Objectifs" class="md-nav__link">
      00 Intro Objectifs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../01_Prerequis_data_soft/" title="01 Prerequis Data Soft" class="md-nav__link">
      01 Prerequis Data Soft
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../02_pretraitement_classification/" title="02 Pretraitement Classification" class="md-nav__link">
      02 Pretraitement Classification
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        03 Formation Scolytes
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" title="03 Formation Scolytes" class="md-nav__link md-nav__link--active">
      03 Formation Scolytes
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tp-02-utilisation-du-package-fordead-detection-de-deperissement-en-foret-a-partir-de-series-temporelles-sentinel-2" class="md-nav__link">
    TP-02 : Utilisation du package fordead : d√©tection de d√©perissement en for√™t √† partir de s√©ries temporelles SENTINEL-2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preambule" class="md-nav__link">
    Pr√©ambule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objectifs" class="md-nav__link">
    Objectifs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-requis" class="md-nav__link">
    Pr√©-requis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-dun-script-pour-detecter-le-deperissement-lie-au-scolyte-sur-une-zone-donnee-a-laide-du-package-fordead" class="md-nav__link">
    Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead
  </a>
  
    <nav class="md-nav" aria-label="Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etape-1-calcul-de-lindice-de-vegetation-et-du-masque-pour-chaque-date-sentinel" class="md-nav__link">
    √âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL
  </a>
  
    <nav class="md-nav" aria-label="√âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faire-tourner-letape-a-partir-du-script" class="md-nav__link">
    Faire tourner l'√©tape √† partir du script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faire-tourner-letape-en-lancant-la-fonction-depuis-linvite-de-commande" class="md-nav__link">
    Faire tourner l'√©tape en lan√ßant la fonction depuis l'invit√© de commande
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-2-modelisation-du-comportement-periodique-de-lindice-de-vegetation" class="md-nav__link">
    √âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation
  </a>
  
    <nav class="md-nav" aria-label="√âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_1" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-3-detection-du-deperissement" class="md-nav__link">
    √âtape 3 : D√©tection du d√©perissement
  </a>
  
    <nav class="md-nav" aria-label="√âtape 3 : D√©tection du d√©perissement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_2" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-4-calcul-du-masque-foret" class="md-nav__link">
    √âtape 4 : Calcul du masque for√™t
  </a>
  
    <nav class="md-nav" aria-label="√âtape 4 : Calcul du masque for√™t">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_3" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualisation-des-resultats" class="md-nav__link">
    Visualisation des r√©sultats
  </a>
  
    <nav class="md-nav" aria-label="Visualisation des r√©sultats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-dun-timelapse" class="md-nav__link">
    Cr√©ation d'un timelapse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualisation-de-la-serie-temporelle-de-pixels-en-particulier" class="md-nav__link">
    Visualisation de la s√©rie temporelle de pixels en particulier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rajouter-des-dates-sentinel-et-mettre-a-jour-la-detection" class="md-nav__link">
    Rajouter des dates SENTINEL et mettre √† jour la d√©tection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changer-les-parametres-de-la-detection" class="md-nav__link">
    Changer les param√®tres de la d√©tection
  </a>
  
    <nav class="md-nav" aria-label="Changer les param√®tres de la d√©tection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changer-lindice-de-vegetation" class="md-nav__link">
    Changer l'indice de v√©g√©tation
  </a>
  
    <nav class="md-nav" aria-label="Changer l'indice de v√©g√©tation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utiliser-un-indice-de-vegetation-non-prevu-dans-le-package" class="md-nav__link">
    Utiliser un indice de v√©g√©tation non pr√©vu dans le package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changer-le-seuil-de-detection-danomalies" class="md-nav__link">
    Changer le seuil de d√©tection d'anomalies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changer-de-zone-detude" class="md-nav__link">
    Changer de zone d'√©tude
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exporter-des-resultats-adaptes-a-ses-besoins" class="md-nav__link">
    Exporter des r√©sultats adapt√©s √† ses besoins
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Img2" class="md-nav__link">
      Img2
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Img3" class="md-nav__link">
      Img3
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Img" class="md-nav__link">
      Img
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      User Guides
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="User Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        <span class="md-nav__icon md-icon"></span>
        User Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/00_installation/" title="00 Installation" class="md-nav__link">
      00 Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/01_compute_masked_vegetationindex/" title="01 Compute Masked Vegetationindex" class="md-nav__link">
      01 Compute Masked Vegetationindex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/02_train_model/" title="02 Train Model" class="md-nav__link">
      02 Train Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/03_decline_detection/" title="03 Decline Detection" class="md-nav__link">
      03 Decline Detection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/04_compute_forest_mask/" title="04 Compute Forest Mask" class="md-nav__link">
      04 Compute Forest Mask
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../user_guides/05_export_results/" title="05 Export Results" class="md-nav__link">
      05 Export Results
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Diagrams" class="md-nav__link">
      Diagrams
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        <span class="md-nav__icon md-icon"></span>
        Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-10-1" type="checkbox" id="nav-10-1">
    
    <label class="md-nav__link" for="nav-10-1">
      Fordead
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Fordead" data-md-level="2">
      <label class="md-nav__title" for="nav-10-1">
        <span class="md-nav__icon md-icon"></span>
        Fordead
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/ImportData/" title="Importdata" class="md-nav__link">
      Importdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/ModelVegetationIndex/" title="Modelvegetationindex" class="md-nav__link">
      Modelvegetationindex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/decline_detection/" title="Decline Detection" class="md-nav__link">
      Decline Detection
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/maja_fun/" title="Maja Fun" class="md-nav__link">
      Maja Fun
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/masking_vi/" title="Masking Vi" class="md-nav__link">
      Masking Vi
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/timelapse/" title="Timelapse" class="md-nav__link">
      Timelapse
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../reference/fordead/writing_data/" title="Writing Data" class="md-nav__link">
      Writing Data
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tp-02-utilisation-du-package-fordead-detection-de-deperissement-en-foret-a-partir-de-series-temporelles-sentinel-2" class="md-nav__link">
    TP-02 : Utilisation du package fordead : d√©tection de d√©perissement en for√™t √† partir de s√©ries temporelles SENTINEL-2
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#preambule" class="md-nav__link">
    Pr√©ambule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#objectifs" class="md-nav__link">
    Objectifs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pre-requis" class="md-nav__link">
    Pr√©-requis
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-dun-script-pour-detecter-le-deperissement-lie-au-scolyte-sur-une-zone-donnee-a-laide-du-package-fordead" class="md-nav__link">
    Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead
  </a>
  
    <nav class="md-nav" aria-label="Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#etape-1-calcul-de-lindice-de-vegetation-et-du-masque-pour-chaque-date-sentinel" class="md-nav__link">
    √âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL
  </a>
  
    <nav class="md-nav" aria-label="√âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#faire-tourner-letape-a-partir-du-script" class="md-nav__link">
    Faire tourner l'√©tape √† partir du script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#faire-tourner-letape-en-lancant-la-fonction-depuis-linvite-de-commande" class="md-nav__link">
    Faire tourner l'√©tape en lan√ßant la fonction depuis l'invit√© de commande
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-2-modelisation-du-comportement-periodique-de-lindice-de-vegetation" class="md-nav__link">
    √âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation
  </a>
  
    <nav class="md-nav" aria-label="√âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_1" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-3-detection-du-deperissement" class="md-nav__link">
    √âtape 3 : D√©tection du d√©perissement
  </a>
  
    <nav class="md-nav" aria-label="√âtape 3 : D√©tection du d√©perissement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_2" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#etape-4-calcul-du-masque-foret" class="md-nav__link">
    √âtape 4 : Calcul du masque for√™t
  </a>
  
    <nav class="md-nav" aria-label="√âtape 4 : Calcul du masque for√™t">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#observation-des-sorties_3" class="md-nav__link">
    Observation des sorties
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualisation-des-resultats" class="md-nav__link">
    Visualisation des r√©sultats
  </a>
  
    <nav class="md-nav" aria-label="Visualisation des r√©sultats">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creation-dun-timelapse" class="md-nav__link">
    Cr√©ation d'un timelapse
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualisation-de-la-serie-temporelle-de-pixels-en-particulier" class="md-nav__link">
    Visualisation de la s√©rie temporelle de pixels en particulier
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rajouter-des-dates-sentinel-et-mettre-a-jour-la-detection" class="md-nav__link">
    Rajouter des dates SENTINEL et mettre √† jour la d√©tection
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#changer-les-parametres-de-la-detection" class="md-nav__link">
    Changer les param√®tres de la d√©tection
  </a>
  
    <nav class="md-nav" aria-label="Changer les param√®tres de la d√©tection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#changer-lindice-de-vegetation" class="md-nav__link">
    Changer l'indice de v√©g√©tation
  </a>
  
    <nav class="md-nav" aria-label="Changer l'indice de v√©g√©tation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#utiliser-un-indice-de-vegetation-non-prevu-dans-le-package" class="md-nav__link">
    Utiliser un indice de v√©g√©tation non pr√©vu dans le package
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changer-le-seuil-de-detection-danomalies" class="md-nav__link">
    Changer le seuil de d√©tection d'anomalies
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#changer-de-zone-detude" class="md-nav__link">
    Changer de zone d'√©tude
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#exporter-des-resultats-adaptes-a-ses-besoins" class="md-nav__link">
    Exporter des r√©sultats adapt√©s √† ses besoins
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://gitlab.com/raphael.dutrieux/fordead_package/edit/master/docs/03_Formation_scolytes.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="detection-des-foyers-de-mortalite-dans-les-massifs-de-coniferes-par-imagerie-satellite-sentinel-2"><div align="center"> D√©tection des foyers de mortalit√© dans les massifs de conif√®res par imagerie satellite Sentinel-2 </div></h1>
<div align="center"> Equipe de formation INRAE : Rapha√´l Dutrieux, Forian de Boissieu, Jean-Baptiste Feret, Kenji Ose </div>

<h2 id="tp-02-utilisation-du-package-fordead-detection-de-deperissement-en-foret-a-partir-de-series-temporelles-sentinel-2"><div align="center">TP-02 : Utilisation du package <code>fordead</code> : d√©tection de d√©perissement en for√™t √† partir de s√©ries temporelles SENTINEL-2</div></h2>
<ul>
<li><a href="#introduction">Introduction</a><ul>
<li><a href="#pr√©ambule">Pr√©ambule</a></li>
<li><a href="#objectifs">Objectifs</a></li>
<li><a href="#pr√©-requis">Pr√©-requis</a></li>
</ul>
</li>
<li><a href="#utilisation-du-package-fordead">Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead</a><ul>
<li><a href="#√©tape-1-calcul-de-lindice-de-v√©g√©tation-et-du-masque-pour-chaque-date-sentinel">√âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL</a></li>
<li><a href="#√©tape-2-mod√©lisation-du-comportement-p√©riodique-de-lindice-de-v√©g√©tation">√âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation</a></li>
<li><a href="#√©tape-3-d√©tection-du-d√©perissement">√âtape 3 : D√©tection du d√©perissement</a></li>
<li><a href="#√©tape-4-calcul-du-masque-for√™t">√âtape 4 : Calcul du masque for√™t</a></li>
</ul>
</li>
<li><a href="#visualisation-des-r√©sultats">Visualisation des r√©sultats</a><ul>
<li><a href="#cr√©ation-dun-timelapse">Visualisation d'un timelapse</a></li>
<li><a href="#visualisation-de-la-s√©rie-temporelle-de-pixels-en-particulier">Visualisation de la s√©rie temporelle de pixels en particulier</a></li>
</ul>
</li>
<li><a href="#rajouter-des-dates-sentinel-et-mettre-√†-jour-la-d√©tection">Rajouter des dates SENTINEL et mettre √† jour la d√©tection</a></li>
<li><a href="#changer-les-param√®tres-de-la-d√©tection">Changer les param√®tres de la d√©tection</a><ul>
<li><a href="#utiliser-un-indice-de-v√©g√©tation-non-pr√©vu-dans-le-package">Changer l'indice de v√©g√©tation</a></li>
<li><a href="#changer-le-seuil-de-d√©tection-danomalies">Changer le seuil de d√©tection d'anomalies</a></li>
<li><a href="#changer-de-zone-d√©tude">Changer de zone d'√©tude</a></li>
</ul>
</li>
<li><a href="#exporter-des-r√©sultats-adapt√©s-√†-ses-besoins">Exporter des r√©sultats adapt√©s √† ses besoins</a></li>
</ul>
<h2 id="introduction">Introduction</h2>
<h3 id="preambule">Pr√©ambule</h3>
<p>Le monde forestier fait face √† une acc√©l√©ration sans pr√©cedent des d√©perissements √† large √©chelle, notamment en lien avec le changement climatique et l'apparition de ravageurs. En particulier, la crise sanitaire du scolyte met en p√©ril la sant√© des for√™ts ainsi que la fili√®re bois dans le Nord-Est de la France. Pour r√©pondre √† cet enjeu, des travaux R&amp;D ont √©t√© men√©s par l‚ÄôUMR TETIS (INRAE, anciennement IRSTEA) √† la demande du Minist√®re de l‚ÄôAgriculture et de l‚ÄôAlimentation pour mettre au point un outil d‚Äôidentification des foyers de scolytes par t√©l√©d√©tection de mani√®re pr√©coce et en continu. Cet outil prend aujourd'hui la forme du package python <code>fordead</code> permettant une cartographie des d√©perissements √† partir d'images SENTINEL-2, potentiellement mise √† jour √† chaque revisite des satellites SENTINEL-2.</p>
<h3 id="objectifs">Objectifs</h3>
<p>Les objectifs de ce TD sont les suivants :
- √™tre capable de faire fonctionner l'ensemble des √©tapes permettant la cartographie des d√©perissements sur une zone donn√©e, ainsi que comprendre l'articulation de ces diff√©rentes √©tapes
- Savoir modifier les param√®tres de l'outil afin de pouvoir s'adapter selon la probl√©matique<br />
- Faire sortir les r√©sultats sous la forme souhait√©e
- Visualiser ces r√©sultats
- Appr√©hender le potentiel et les limites de l'outil</p>
<h3 id="pre-requis">Pr√©-requis</h3>
<p>Si le package n'est pas encore install√©, suivre le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/00_installation.md">guide d'installation</a>.</p>
<p>Sinon, lancer l'invit√© de commande <em>anaconda prompt</em>, puis activer l'environnement par la commande : </p>
<div class="codehilite"><pre><span></span><code>conda activate ForDeadEnv
</code></pre></div>

<h2 id="creation-dun-script-pour-detecter-le-deperissement-lie-au-scolyte-sur-une-zone-donnee-a-laide-du-package-fordead">Cr√©ation d'un script pour d√©tecter le d√©p√©rissement li√© au scolyte sur une zone donn√©e √† l'aide du package fordead</h2>
<p>La d√©tection du d√©perissement permet d'utiliser l'ensemble des donn√©es SENTINEL-2 depuis le lancement du premier satellite. M√™me en prenant une seule tuile, un tel jeu de donn√©es p√®se plusieurs centaines de gigaoctets et prend plusieurs heures de temps de calcul pour r√©aliser l'ensemble des √©tapes de d√©tection du d√©perissement. Pour cette raison, un jeu de donn√©es plus r√©duit a √©t√© pr√©par√© pour cette formation. Il contient l'ensemble des donn√©es SENTINEL-2 disponible sur une zone d'√©tude restreinte, en croppant √† partir des donn√©es de la tuile. Cette zone est touch√©e par les scolytes, et contient plusieurs polygones de donn√©es de validation, ce qui en fait un bon exemple pour l'application de la d√©tection de d√©perissement et la visualisation des r√©sultats. </p>
<ul>
<li>Cr√©er un script python en cr√©ant un nouveau fichier de texte dans le dossier <MyWorkingDirectory>/B_PROGRAMS, et en le nommant <em>detection_scolytes.py</em> (ou le nom de votre choix, mais avec l'extension .py)</li>
<li>Ouvrez ce script avec l'√©diteur de votre choix</li>
</ul>
<h4 id="etape-1-calcul-de-lindice-de-vegetation-et-du-masque-pour-chaque-date-sentinel">√âtape 1 : Calcul de l'indice de v√©g√©tation et du masque pour chaque date SENTINEL</h4>
<p>La premi√®re √©tape consiste √† calculer pour chaque date l'indice de v√©g√©tation, et le masque. Le masque correspond √† l'ensemble des donn√©es invalides, car ennuag√©es, enneig√©es, dans l'ombre, hors de la fauch√©e du satellite, peuplement d√©j√† coup√©...
Vous pouvez retrouver le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/01_compute_masked_vegetationindex.md">guide d'utilisation de cette √©tape</a>.</p>
<h5 id="faire-tourner-letape-a-partir-du-script">Faire tourner l'√©tape √† partir du script</h5>
<p>Pour effectuer cette √©tape, ajoutez dans le script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.steps.step1_compute_masked_vegetationindex import compute_masked_vegetationindex
</code></pre></div>

<ul>
<li>Pour choisir les param√®tres en entr√©e :</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">input_directory</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude&quot;</span>
<span class="nv">data_directory</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/C_RESULTS/ZoneEtude&quot;</span>
</code></pre></div>

<blockquote>
<p><strong><em>NOTE :</em></strong> Il est pr√©f√©rable d'utiliser "/" plut√¥t que "\" √† l'√©criture des chemins afin d'√©viter les soucis.</p>
</blockquote>
<ul>
<li>Pour lancer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>compute_masked_vegetationindex<span class="o">(</span><span class="nv">input_directory</span> <span class="o">=</span> input_directory, <span class="nv">data_directory</span> <span class="o">=</span> data_directory<span class="o">)</span>
</code></pre></div>

<p>Puis lancer le script python depuis l'invit√© de commande en vous pla√ßant dans le r√©pertoire du script en utilisant la commande suivante :</p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> &lt;MyWorkingDirectory&gt;/B_PROGRAMS
</code></pre></div>

<p>Puis lancer le script :</p>
<div class="codehilite"><pre><span></span><code>python detection_scolytes.py
</code></pre></div>

<h5 id="faire-tourner-letape-en-lancant-la-fonction-depuis-linvite-de-commande">Faire tourner l'√©tape en lan√ßant la fonction depuis l'invit√© de commande</h5>
<p>Il est √©galement possible d'appliquer la m√™me √©tape en passant par l'invit√© de commande.
Depuis l'invit√© de commande, placez vous dans le dossier du package fordead_package/fordead/steps par la commande : </p>
<div class="codehilite"><pre><span></span><code><span class="nb">cd</span> &lt;MyWorkingDirectory&gt;/B_PROGRAMS/Libraries/fordead_package/fordead/steps
</code></pre></div>

<p>Puis, la commande suivante permet d'afficher l'aide :</p>
<div class="codehilite"><pre><span></span><code>python step1_compute_masked_vegetationindex.py -h
</code></pre></div>

<p>A partir de l'aide, lancez la fonction en appliquant vos param√®tres. Exemple :</p>
<div class="codehilite"><pre><span></span><code>python step1_compute_masked_vegetationindex.py -i &lt;MyWorkingDirectory&gt;/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude -o &lt;MyWorkingDirectory&gt;/C_RESULTS/ZoneEtude
</code></pre></div>

<blockquote>
<p><strong><em>NOTE :</em></strong> <strong>-i</strong> permet de d√©finir le param√®tre <strong>input_directory</strong> et <strong>-o</strong> le param√®tre <strong>data_directory</strong>, ainsi exactement la m√™me fonction est lanc√©e.</p>
</blockquote>
<p>Vous remarquerez que si vous avez utilis√© les m√™me param√®tres dans les deux cas, il s'affiche "0 new SENTINEL dates" et le programme tourne plus rapidement la deuxi√®me fois, car les indices de v√©g√©tation d√©j√† calcul√©s ne sont pas recalcul√©s. En revanche, si vous changez les param√®tres, les r√©sultats pr√©c√©dants seront supprim√©s et remplac√©s.
Les param√®tres input_directory et data_directory sont les deux seuls √† ne pas conna√Ætre de valeur par d√©faut puisqu'elles d√©pendent de l'emplacement de vos fichiers. Ce sont donc les deux seuls param√®tres √† renseigner obligatoirement, mais il est tout de m√™me possible de modifier les autres param√®tres. A l'aide du guide d'utilisateur, v√©rifiez que vous comprenez le sens des diff√©rents param√®tres et n'h√©sitez pas √† poser des questions si ce n'est pas le cas !</p>
<p>L'ensemble des √©tapes de la d√©tection peuvent se r√©aliser de mani√®re identique depuis l'invit√© de commande, ou par import des diff√©rentes fonctions dans un script. Dans la suite de ce TD, nous nous focaliseront sur le script en le compl√©tant au fur et √† mesure.</p>
<h5 id="observation-des-sorties">Observation des sorties</h5>
<p>Pour mieux vous repr√©senter les sorties de cette √©tape, lancez QGIS et ajoutez les rasters <strong>VegetationIndex/VegetationIndex_2018-07-27.tif</strong> et <strong>Mask/Mask_2018-07-27.tif</strong>.</p>
<p>Nous allons √©galement comparer ces exports avec les rasters des donn√©es SENTINEL-2 dont ils sont issus. Pour cela, allez dans le dossier <strong><MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude/SENTINEL2A_20180727-104023-458_L2A_T31UGP_D_V1-8</strong>, puis rajoutez les bandes B2, B3, B4 √† QGIS, soit respectivement les bandes rouge, vert et bleu. Ensuite, nous allons cr√©er un raster virtuelle √† partir de ces trois bandes pour visualiser une image en couleur.
- Aller dans Raster/Divers/Construire un raster virtuel
<img alt="raster_virtuel_1" src="../img3/raster_virtuel_1.png" title="raster_virtuel_1" />
-  S√©lectionner les bandes ajout√©es
<img alt="raster_virtuel_2" src="../img3/raster_virtuel_2.png" title="raster_virtuel_2" />
<img alt="raster_virtuel_3" src="../img3/raster_virtuel_3.png" title="raster_virtuel_3" />
- Cocher pour que chaque fichier de bande aille dans une bande diff√©rente
<img alt="raster_virtuel_4" src="../img3/raster_virtuel_4.png" title="raster_virtuel_4" />
- Executer
- Aller dans les propri√©t√©s du raster cr√©e
<img alt="raster_virtuel_5" src="../img3/raster_virtuel_5.png" title="raster_virtuel_5" />
- Les bandes devraient ne pas √™tre dans le bon ordre, mettre la bande 3 en rouge et la bande 1 en bleu. Modifiez l'√©chelle pour aller de 0 √† 600 pour chaque bande.
<img alt="raster_virtuel_6" src="../img3/raster_virtuel_6.png" title="raster_virtuel_6" /></p>
<p>Observez les r√©sultats.</p>
<p>Les rasters dans le dossier DataSoil contiennent les informations relatives √† la d√©tection du sol nu. Ce sol d√©tect√© peut correspondre √† des zones non foresti√®res, √† des peuplements feuillus dont le sol est d√©tect√© en hiver, ou des coupes rases. Il y a trois rasters, qui, ensemble, permettent de reconstituer l'ensemble de l'information, et de la mettre √† jour avec l'arriv√©e de nouvelles dates SENTINEL :
- Le raster count_soil.tif compte le nombre d'anomalies de sol successives.
- Lorsque count_soil atteint 3, pour trois anomalies successives, le raster state_soil.tif passe de 0 √† 1. Les pixels avec la valeur 1 correspondent donc √† ceux d√©tect√©s comme sol nu / coupe au bout de l'analyse de l'ensemble des dates.
- Le raster first_date_soil.tif contient l'index de la date de premi√®re anomalie de sol. Si state_soil vaut 1, il s'agit alors de la date √† partir de laquelle le sol est d√©tect√©e. 
Ces rasters peuvent √™tre difficiles √† analyser puisque, n'√©tant pas possible de mettre une date dans un raster, le raster first_date_soil contient <strong>l'index</strong> de la date qui peut √™tre interpr√©t√© par le package dans les √©tapes suivantes.</p>
<h4 id="etape-2-modelisation-du-comportement-periodique-de-lindice-de-vegetation">√âtape 2 : Mod√©lisation du comportement p√©riodique de l'indice de v√©g√©tation</h4>
<p>Pour mod√©liser le comportement normal de l'indice de v√©g√©tation, on utilise seulement les dates SENTINEL les plus anciennes, en faisant l'hypoth√®se qu'elles sont ant√©rieures √† un possible d√©perissement. La fonction harmonique suivante est ajust√©e √† ces donn√©es :
ùíá(ùíï)=ùíÇùüè+ùíÉùüè.ùê¨ùê¢ùêß‚Å°(ùüêùùÖùíï/ùëá)+ùíÉùüê.ùêúùê®ùê¨‚Å°(ùüêùùÖùíï/ùëá)+ùíÉùüë.ùê¨ùê¢ùêß‚Å°(ùüíùùÖùíï/ùëá)+ùíÉùüí.ùêúùê®ùê¨‚Å°(ùüíùùÖùíï/ùëá) o√π T = 365,25.
Vous pouvez retrouver le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/02_train_model.md">guide d'utilisation de cette √©tape</a>.</p>
<p>Pour effectuer cette √©tape, ajoutez dans le script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.steps.step2_train_model import train_model
</code></pre></div>

<ul>
<li>Pour lancer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>train_model<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory<span class="o">)</span>
</code></pre></div>

<p>Puis, comme pour l'√©tape 1, relancez le script depuis l'invit√© de commande :</p>
<div class="codehilite"><pre><span></span><code>python detection_scolytes.py
</code></pre></div>

<p>Le reste des param√®tres connaissent une valeur par d√©faut dans la fonction et n'ont pas besoin d'√™tre renseign√©es. Ces valeurs par d√©faut ont √©t√© d√©termin√©es de mani√®re empirique pour la probl√©matique du scolyte et peuvent ne pas √™tre optimales selon la localisation ou la probl√©matique donn√©e. Le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/02_train_model.md">guide d'utilisation</a> donne des d√©tails sur les diff√©rents param√®tres, lisez le et v√©rifiez que vous comprenez bien leur sens.</p>
<blockquote>
<p><strong><em>NOTE :</em></strong> Si l'utilisateur ne souhaite pas utiliser la premi√®re √©tape et choisit de calculer ses propres indices de v√©g√©tations et masques. Il peut sauter l'√©tape 1 et simplement donner le chemin de son dossier d'indices de v√©g√©tation avec le param√®tre <strong>path_vi</strong> et son dossier de masques avec <strong>path_masks</strong>. Il suffit simplement que le nom des rasters contiennent la date sous un des formats suivants : AAAA-MM-JJ, AAAA_MM_JJ, AAAAMMJJ, JJ-MM-AAAA, JJ_MM_AAAA ou JJMMAAAA.</p>
</blockquote>
<h5 id="observation-des-sorties_1">Observation des sorties</h5>
<p>Dans le dossier DataModel :
- Ouvrez le raster coeff_model.tif dans QGIS. Faites un clique droit sur un des pixels, vous pouvez constater qu'il s'agit d'un raster √† cinq bandes. QGIS affiche une image en RGB √† partir des trois premi√®res bandes. Chacune des bandes correspond √† un des coefficients (a1, b1, b2, b3, b4) du mod√®le (voir √©quation). On a bien un mod√®le diff√©rent par pixel ce qui permet qu'il soit adapt√© aux conditions de ce pixel. On peut en effet imaginer que la composition du peuplement, sa surface terri√®re, sa pente, son exposition ont probablement un r√¥le √† jouer dans la valeur donn√©e des indices de v√©g√©tation. A partir de ces coefficients, il est possible de pr√©dire l'indice de v√©g√©tation √† n'importe quelle date, pour un peuplement sain.</p>
<ul>
<li>Ouvrez maintenant le raster first_detection_date_index.tif. Il permet de conna√Ætre pour chaque pixel les dates utilis√©es pour l'apprentissage du mod√®le, et celles utilis√©es pour la d√©tection de d√©perissement. Il contient l'index de la premi√®re date √† partir de laquelle le d√©perissement est d√©tect√©. Sur cette zone, il y a assez de dates valides pour que l'ensemble des pixels terminent leur apprentissage avant la premi√®re date de 2018 (le param√®tre <strong>min_last_date_training</strong> est fix√© √† 2018-01-01 par d√©faut ce qui permet d'avoir un recul de deux ans d'images satellites SENTINEL-2), ils ont donc tous la m√™me valeur sauf les zones "sans donn√©es" qui correspondent aux zones d√©tect√©es comme "sol nu / coupe" tr√®s t√¥t, qui sont donc masqu√©es sur la quasi-totalit√© des dates et qui n'ont donc pas le nombre de dates valides minimum pour le calcul du mod√®le. </li>
</ul>
<p>Dans le dossier ForestMask, ouvrez √©galement le raster valid_area_mask.tif. Il s'agit d'un raster binaire qui vaut 1 l√† o√π il y avait suffisamment de dates valides pour le calcul du mod√®le et 0 ailleurs.</p>
<h4 id="etape-3-detection-du-deperissement">√âtape 3 : D√©tection du d√©perissement</h4>
<p>Lors de cette √©tape, pour chaque date SENTINEL non utilis√©e pour l'apprentissage, l'indice de v√©g√©tation r√©el est compar√© √† l'indice de v√©g√©tation pr√©dit √† partir des mod√®les calcul√©s dans l'√©tape pr√©c√®dente. Si la diff√©rence d√©passe un seuil, une anomalie est d√©tect√©e. Si trois anomalies successives sont d√©tect√©es, le pixel est consid√©r√© comme d√©p√©rissant. Si apr√®s avoir √©t√© d√©tect√© comme d√©perissant, le pixel a trois dates successives sans anomalies, il n'est plus consid√©r√© comme d√©p√©rissant. N'h√©sitez pas √† consulter le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/03_decline_detection.md">guide d'utilisation</a> de cette √©tape.</p>
<p>Pour effectuer cette √©tape, ajouter au script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.steps.step3_decline_detection import decline_detection
</code></pre></div>

<ul>
<li>Pour lancer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>decline_detection<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory<span class="o">)</span>
</code></pre></div>

<p>Puis, relancez le script depuis l'invit√© de commande :</p>
<div class="codehilite"><pre><span></span><code>python detection_scolytes.py
</code></pre></div>

<h5 id="observation-des-sorties_2">Observation des sorties</h5>
<p>Pour chaque date post√©rieure √† la date renseign√©e par le param√®tre <strong>min_last_date_training</strong>, un raster Anomalies_<date>.tif est export√© dans le dossier <strong>DataAnomalies</strong>. 
- Ouvrez dans QGIS le raster <strong>Anomalies_2018-07-27.tif</strong>.
- Mettez en regard ces r√©sultats avec l'indice de v√©g√©tation et le masque calcul√© pour la date et ouvert pr√©c√©demment, ainsi que l'image en RGB.
On peut voir que des anomalies sont d√©tect√©es m√™me l√† o√π les donn√©es sont masqu√©es, comme pour les nuages sur la gauche de l'image, o√π les zones d√©tect√©es comme sol nu. Ces anomalies ne sont bien entendu pas prises en compte. Les anomalies pouvant correspondre √† des d√©gats de scolytes sont celles qui ne sont pas masqu√©es.</p>
<p>Un autre dossier a √©t√© cr√©e, DataDecline. Les rasters de ce dossier contiennent les informations relatives √† la d√©tection de d√©p√©rissement √† partir des anomalies observ√©es pr√©c√©demment. Ces rasters sont exactement sous la m√™me forme que les rasters dans DataSoil observ√©s lors de l'√©tape 1. La seule diff√©rence est que un "retour √† la normale" est possible. Une fois que le sol est d√©tect√©, l'√©tat "sol nu" est permanent, tandis que pour le d√©p√©rissement, un pixel d√©tect√© comme d√©p√©rissant peut retourner √† l'√©tat non-d√©p√©rissant s'il y a trois dates successives sans anomalies. Cela permet d'√©viter des faux positifs caus√©s par des stress hydriques importants mais temporaires et ne causant pas de d√©p√©rissement.
Les informations de ces rasters sont les suivantes :
- le raster state_decline.tif, un raster binaire qui vaut 1 pour les pixels d√©p√©rissants, 0 pour les pixels sains
- Le raster count_decline.tif compte le nombre d'anomalies successives pour les pixels sains dans state_decline, ou le nombre de dates sans anomalies successives pour les pixels d√©p√©rissants dans state_decline. Quand count_decline atteint trois, le pixel change d'√©tat, de sain √† d√©p√©rissant ou inversement.
- Le raster first_date_decline.tif contient l'index de la date de premi√®re anomalie. Si state_decline vaut 1, il s'agit alors de la date √† partir de laquelle le d√©p√©rissement est d√©t√©ct√©.</p>
<h4 id="etape-4-calcul-du-masque-foret">√âtape 4 : Calcul du masque for√™t</h4>
<p>L'ensemble des calculs pr√©cedents sont r√©alis√©s sur l'ensemble des pixels de la zone d'√©tude. Cependant, en particulier lorsqu'on travaille sur de larges zones, il est n√©cessaire de d√©finir les zones d'int√©r√™ts pour ne pas interpr√©ter des r√©sultats sur des zones urbaines, des cultures, etc...
Dans le cas du scolyte, on s'int√©resse uniquement aux peuplements forestiers r√©sineux. Cette √©tape permet de cr√©er le masque for√™t correspondant √† notre zone d'int√©r√™t. Vous pouvez consulter son <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/04_compute_forest_mask.md">guide d'utilisation</a>.</p>
<p>Pour effectuer cette √©tape, ajouter au script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.steps.step4_compute_forest_mask import compute_forest_mask
</code></pre></div>

<ul>
<li>Pour lancer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>compute_forest_mask<span class="o">(</span>data_directory, <span class="nv">forest_mask_source</span> <span class="o">=</span> <span class="s1">&#39;BDFORET&#39;</span>, 
                    <span class="nv">dep_path</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/A_DATA/VECTOR/BD_ADMIN/departements-20140306-100m.shp&quot;</span>,
                    <span class="nv">bdforet_dirpath</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/A_DATA/VECTOR/BD_FORET&quot;</span><span class="o">)</span>
</code></pre></div>

<p>Puis, relancez le script depuis l'invit√© de commande :</p>
<div class="codehilite"><pre><span></span><code>python detection_scolytes.py
</code></pre></div>

<blockquote>
<p><strong><em>NOTE :</em></strong> Il est possible d'utiliser cette √©tape d√©connect√©e des autres en pr√©cisant le param√®tre <strong>path_example_raster</strong> avec le chemin d'un raster "exemple" qui donnera son syst√®me de projection, sa r√©solution, son extent au masque produit. Ne pas renseigner ce param√®tre ne pose pas de soucis puisque le chemin d'un raster exemple peut √™tre r√©cup√©r√© depuis les √©tapes pr√©c√©dentes par le biais du fichier TileInfo.</p>
</blockquote>
<h5 id="observation-des-sorties_3">Observation des sorties</h5>
<p>Cette √©tape permet d'√©crire un uniquement raster, Forest_Mask.tif dans le dossier ForestMask. Ouvrez ce raster. Il s'agit d'un raster binaire qui vaut 1 dans la zone d'int√©r√™t, 0 ailleurs. Avec les param√®tres renseign√©s ici, il est cr√©e √† partir de la rasterisation de la BD For√™t de l'IGN en gardant uniquement les peuplements r√©sineux. </p>
<h2 id="visualisation-des-resultats">Visualisation des r√©sultats</h2>
<p>Les √©tapes r√©alis√©es pr√©c√©demment ont permis d'obtenir l'ensemble des r√©sultats relatifs √† la d√©tection de scolytes, mais sous une forme difficile √† analyser. Le package contient certains outils permettant de visualiser les r√©sultats sous une forme plus digeste.</p>
<h3 id="creation-dun-timelapse">Cr√©ation d'un timelapse</h3>
<p>Pour commencer, nous allons cr√©er un timelapse de la d√©tection sur la zone analys√©e. Pour ce faire, ajouter dans le script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.visualisation.create_timelapse import create_timelapse
</code></pre></div>

<ul>
<li>Pour ajouter les param√®tres n√©c√©ssaires :</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">shape_path</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude.shp&quot;</span>
</code></pre></div>

<ul>
<li>Pour lancer la fonction :</li>
</ul>
<div class="codehilite"><pre><span></span><code>create_timelapse<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory,shape_path <span class="o">=</span> shape_path, <span class="nv">obs_terrain_path</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/A_DATA/VECTOR/BD_SCOLYTE/ValidatedScolytes.shp&quot;</span><span class="o">)</span>
</code></pre></div>

<ul>
<li>Enfin, relancez le script.</li>
</ul>
<p>Cette fonction prend en entr√©e un shapefile avec un champ "Id" dans lequel il peut y avoir un ou plusieurs polygones et √©crit pour chaque polygone un fichier <Id>.html dans le dossier "Timelapses". Elle est plut√¥t pens√©e pour visualiser les r√©sultats sur une zone r√©duite √† partir des r√©sultats d'une tuile enti√®re, il est recommand√© d'√©viter de lancer cette op√©ration avec des polygones de plus d'une vingtaine de km¬≤. Cependant, on travaille ici d√©j√† sur une zone r√©duite, en utilisant un shapefile d'un seul polygone couvrant l'ensemble de la zone. Le timelapse devrait se lancer automatiquement, sinon ouvrez le fichier <id>.html (il est possible que sa lecture fonctionne mieux sous Chrome).</p>
<p>Une fois le timelapse ouvert, faites glisser le slider en bas de l'image pour vous d√©placer temporellement dans l'animation. Les polygones noirs correspondent aux zones d√©tect√©es comme sol nu, les polygones jaunes correspondent aux zones d√©tect√©es comme d√©p√©rissantes et les polygones bleus correspondent aux coupes sanitaires, c'est √† dire les zones d√©tect√©es comme sol-nu/coupe apr√®s avoir √©t√© d√©tect√©es comme atteintes.</p>
<p>Les donn√©es d'observation sur le terrain sont √©galement affich√©es, passez la souris sur ces polygones pour obtenir leurs informations : <stade de scolyte> | <organisme √† l'origine de la donn√©e> : <date d'observation>. Sur cette zone, on peut observer des zones saines en vert fonc√© et des zones scolyt√©es au stade rouge en rouge.</p>
<p>Vous pouvez √©galement zoomer sur la zone souhait√©e en maintenant le clique appuy√© tout en d√©limitant une zone. Vous pouvez ensuite d√©zoomer en double cliquant sur l'image. Passer la souris sur un pixel permet √©galement d'obtenir ses informations :
- x : coordonn√©es en x
- y : coordonn√©es en y
- z : [<r√©flectance dans le rouge>,<r√©flectance dans le vert>,<r√©flectance dans le bleu>], c'est √† dire la valeur de la bande SENTINEL correspondante √† la date donn√©e.</p>
<p>Les r√©sultats apparaissent √† la date de la premi√®re anomalie, confirm√©e par la suite. Les fausses d√©tections li√©es √† un stress hydrique temporaire et corrig√©es par la suite n'apparaissent pas. De m√™me, pour les derni√®res dates, il peut y avoir des anomalies n'apparaissant pas encore par manque de dates valides pour confirmer la d√©tection.</p>
<p>Prenez le temps d'explorer cet outil et les r√©sultats de la d√©tection. Vous pouvez remarquer que les polygones observ√©s comme atteints sur le terrain sont d√©tect√©s comme atteints avant la date d'observation, tandis que les polygones observ√©s comme sains sont encore sains √† la date d'observation, mais pas forc√©ment par la suite.</p>
<h3 id="visualisation-de-la-serie-temporelle-de-pixels-en-particulier">Visualisation de la s√©rie temporelle de pixels en particulier</h3>
<p>Lors de la visualisation du timelapse, vous avez pu vous poser des questions sur les r√©sultats de pixels en particulier. L'outil suivant va permettre d'afficher l'ensemble de la s√©rie temporelle utilis√©e pour un pixel en particulier, mis en relation avec les r√©sultats de l'algorithme.
Pour utiliser cet outil, ajouter dans le script :</p>
<ul>
<li>Pour importer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>from fordead.visualisation.vi_series_visualisation import vi_series_visualisation
</code></pre></div>

<ul>
<li>Pour lancer la fonction :</li>
</ul>
<div class="codehilite"><pre><span></span><code>vi_series_visualisation<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory<span class="o">)</span>
</code></pre></div>

<p>De plus, pour √©viter que le timelapse soit recalcul√©, mettez en commentaire la fonction √† l'origine du timelapse en ajoutant "#" en d√©but de ligne. Toute ligne comment√©e est ignor√©e au lancement du script :</p>
<div class="codehilite"><pre><span></span><code><span class="c1">#create_timelapse(data_directory = data_directory,shape_path = shape_path, obs_terrain_path = obs_terrain_path)</span>
</code></pre></div>

<ul>
<li>Enfin, relancez le script</li>
</ul>
<p>Cette fonction permet de donner les coordonn√©es en X,Y du pixel souhait√© afin d'en visualiser les r√©sultats. A l'aide du timelapse r√©alis√© pr√©c√©demment, choisissez un pixel, r√©cup√©rez ses coordonn√©es en passant votre souris sur celui ci, puis renseignez ces coordonn√©es dans l'invit√© de commande qui devrait indiquer :</p>
<div class="codehilite"><pre><span></span><code>X ?
</code></pre></div>

<p>Puis</p>
<div class="codehilite"><pre><span></span><code>Y ?
</code></pre></div>

<p>Un graphique doit alors s'afficher, avec la l√©gende associ√©e. Chaque point correspond √† une date SENTINEL valide, avec la valeur de l'indice de v√©g√©tation calcul√©. V√©rifiez que vous comprenez chaque √©l√©ment du graphique, et n'h√©sitez pas √† poser la question s'il y a des points de doute.</p>
<p>Apr√®s avoir ferm√© le graphique, vous pourrez renseigner d'autres coordonn√©es. R√©p√©tez cette op√©ration pour au moins cinq pixels :
- Un pixel qui reste sain jusqu'√† la derni√®re date SENTINEL disponible
- Un pixel manifestement atteint √† la derni√®re date SENTINEL disponible
- Un pixel atteint puis coup√©
- Un pixel coup√© sans avoir √©t√© d√©tect√© comme atteint
- Un pixel hors du masque for√™t. Ce masque n'est pas renseign√© sur le timelapse, mais vous pouvez deviner que certaines zones auraient d√ª √™tre d√©tect√©es comme "sol nu" √† certaines parties de l'ann√©e. Ou vous pouvez vous aider du masque for√™t ouvert dans QGIS. </p>
<p>Vous pouvez aussi appuyer sur Entr√©e sans renseigner de coordonn√©e X, dans ce cas, la fonction affiche la s√©rie temporelle d'un pixel au hasard au sein du masque for√™t.
Prenez le temps d'observer les pixels qui vous int√©ressent.</p>
<p>Une fois que vous avez termin√© vos observations, renseignez -1 comme coordonn√©e X pour terminer le programme.
L'ensemble des graphiques ayant √©t√© cr√©es sont disponibles dans le dossier "SeriesTemporelles".</p>
<blockquote>
<p><strong><em>NOTE :</em></strong> Il est √©galement possible d'utiliser la fonction <code>vi_series_visualisation</code> en ajoutant le param√®tre <em>shape_path = <chemin d'un shapefile de points></em>. Ce shapefile de points doit contenir un champ "id" avec un identifiant num√©rique pour chaque point. Les pixels correspondants √† chaque point sont alors identifi√©s et leurs graphiques sont sauvegard√©s dans le dossier "SeriesTemporelles". Cela permet de r√©aliser ces graphiques sans passer par la cr√©ation du timelapse pour r√©cup√©rer les coordonn√©es X,Y qui ne sont pas associ√©es √† un syst√®me de projection.</p>
</blockquote>
<h2 id="rajouter-des-dates-sentinel-et-mettre-a-jour-la-detection">Rajouter des dates SENTINEL et mettre √† jour la d√©tection</h2>
<p>L'algorithme permet √©galement de mettre √† jour la d√©tection avec de nouvelles images SENTINEL. Nous utilisions auparavant les dates SENTINEL depuis les premi√®res images jusqu'au 01/06/2020. Dans le dossier <MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/MAJ_ZoneEtude sont disponibles les dates SENTINEL allant jusqu'√† la fin de 2020. Nous allons mettre √† jour la d√©tection √† partir de ces donn√©es. Pour ce faire :</p>
<ul>
<li>Copiez ou coupez ces donn√©es dans le dossier <MyWorkingDirectory>/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude</li>
<li>D√©commentez la fonction permettant de cr√©er le timelapse en retirant le "#"</li>
<li>Coupez-collez le dossier "Timelapses" et "SeriesTemporelles" dans un autre dossier, par exemple en cr√©ant un dossier <MyWorkingDirectory>/C_RESULTS/Save_ZoneEtude. Cela permettra de comparer avant et apr√®s mise √† jour, puisque les nouveaux timelapses et graphiques cr√©es remplaceront les anciens. C'est optionnel mais permettra de ne rien √©craser.</li>
<li>relancez le script </li>
</ul>
<p>On peut voir que l'algorithme ne r√©alise les calculs que sur les nouvelles dates, √† partir du mod√®le d√©j√† √©tabli.
Prenez le temps d'examiner les nouveaux r√©sultats, et √©ventuellement de les comparer avec les anciens.</p>
<h2 id="changer-les-parametres-de-la-detection">Changer les param√®tres de la d√©tection</h2>
<p>Depuis le d√©but de ce TD, nous avons laiss√© tous les param√®tres √† leur valeur par d√©faut. Ces valeurs ont √©t√© d√©termin√©es de mani√®re empirique pour la d√©tection de scolytes. Il est int√©ressant de savoir modifier ces param√®tres afin de s'adapter √† des situations locales, ou d'autres probl√©matiques. Pour commencer, supprimez l'ensemble des couches rajout√©es √† QGIS li√©es aux r√©sultats pr√©c√©dents (pas besoin de retirer le raster virtuel en RGB). Le changement des param√®tres entra√Ænera la suppression des r√©sultats pr√©c√©dents, si ils sont ouverts dans QGIS, ils ne pourront pas √™tre supprim√©s et cela occasionnera des bugs. </p>
<h3 id="changer-lindice-de-vegetation">Changer l'indice de v√©g√©tation</h3>
<p>L'indice de v√©g√©tation utilis√© jusqu'ici est le CRSWIR, sensible √† la teneur en eau. La teneur en eau √©tant la premi√®re caract√©ristique de la v√©g√©tation affect√©e lors d'attaques de scolytes, il donne de bons r√©sultats pour la d√©tection de scolytes. Cependant, il existe d'autres indices de v√©g√©tation, dont le plus connu est probablement le NDVI, plut√¥t sensible √† l'activit√© photo-synth√©tique, les pigments chlorophylliens... 
- L'utilisation du NDVI est d√©j√† pr√©vue dans le package, pour l'utiliser il suffit donc simplement de rajouter le param√®tre <code>vi = "NDVI"</code> dans la fonction <em>compute_masked_vegetationindex</em> :</p>
<div class="codehilite"><pre><span></span><code>compute_masked_vegetationindex<span class="o">(</span><span class="nv">input_directory</span> <span class="o">=</span> input_directory, <span class="nv">data_directory</span> <span class="o">=</span> data_directory, <span class="nv">vi</span> <span class="o">=</span> <span class="s2">&quot;NDVI&quot;</span><span class="o">)</span>
</code></pre></div>

<ul>
<li>Rajouter les param√®tres <code>ymin = 0, ymax = 1.1</code> √† la fonction <code>vi_series_visualisation(data_directory = data_directory)</code>. Ces param√®tres permettent de donner les limites en ordonn√©e des graphiques de s√©ries temporelles, car le NDVI n'a pas la m√™me √©chelle que le CRSWIR.</li>
</ul>
<div class="codehilite"><pre><span></span><code>vi_series_visualisation<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory,ymin <span class="o">=</span> <span class="m">0</span>, <span class="nv">ymax</span> <span class="o">=</span> <span class="m">1</span>.1<span class="o">)</span>
</code></pre></div>

<ul>
<li>Sauvegardez vos visualisations si vous souhaitez effectuer une comparaison (optionnel)</li>
<li>Relancez le script.</li>
</ul>
<p>Prenez le temps de visualiser les r√©sultats.</p>
<h4 id="utiliser-un-indice-de-vegetation-non-prevu-dans-le-package">Utiliser un indice de v√©g√©tation non pr√©vu dans le package</h4>
<p>La version actuelle du package ne pr√©voit que les indices de v√©g√©tation "CRSWIR" et "NDVI". Nous allons donc maintenant apprendre comment rajouter n'importe quel indice de v√©g√©tation pour l'utiliser dans la d√©tection. Par exemple, prenons le NDWI (Normalized Difference Water Index), un indice de v√©g√©tation li√© √† la teneur en eau de la v√©g√©tation qui suit la formule suivante : </p>
<div class="codehilite"><pre><span></span><code><span class="err">\frac{B8A-B11}{B8A+B11}</span>
</code></pre></div>

<ul>
<li>Cr√©er un fichier texte <code>dict_vi.txt</code> dans le dossier <MyWorkingDirectory>/B_PROGRAMS (Vous pouvez en r√©alit√© utiliser le nom et dossier de votre choix)</li>
<li>Dans ce fichier texte, ajoutez la ligne suivante, avant de sauvegarder :</li>
</ul>
<div class="codehilite"><pre><span></span><code>NDWI <span class="o">(</span>B8A-B11<span class="o">)</span>/<span class="o">(</span>B8A+B11<span class="o">)</span> -
</code></pre></div>

<p>o√π "NDWI" est le nom de l'indice, "(B8A-B11)/(B8A+B11)" est sa formule, et "-" est la direction vers laquelle l'indice de v√©g√©tation tend lorsqu'il y a d√©perissement. L'algorithme accepte "-" ou "+", on a d√©j√† pu voir que le CRSWIR augmente en cas de d√©perissement, tandis que le NDVI diminue.
- Ajouter dans le script le param√®tre <code>path_dict_vi = "&lt;MyWorkingDirectory&gt;/B_PROGRAMS/dict_vi.txt"</code> √† la fonction <code>compute_masked_vegetationindex</code>, et changer le nom de l'indice de v√©g√©tation pour "NDWI" :</p>
<div class="codehilite"><pre><span></span><code>compute_masked_vegetationindex<span class="o">(</span><span class="nv">input_directory</span> <span class="o">=</span> input_directory, <span class="nv">data_directory</span> <span class="o">=</span> data_directory, <span class="nv">vi</span> <span class="o">=</span> <span class="s2">&quot;NDWI&quot;</span>, <span class="nv">path_dict_vi</span> <span class="o">=</span> <span class="s2">&quot;&lt;MyWorkingDirectory&gt;/B_PROGRAMS/dict_vi.txt&quot;</span><span class="o">)</span>
</code></pre></div>

<ul>
<li>Relancez le script</li>
<li>Observez les r√©sultats</li>
</ul>
<h3 id="changer-le-seuil-de-detection-danomalies">Changer le seuil de d√©tection d'anomalies</h3>
<p>Le seuil de d√©tection des anomalies est r√©gl√© par d√©faut √† 0.16, c'est √† dire que la diff√©rence entre la courbe "Mod√©lisation de l'indice de v√©g√©tation sur les dates d'apprentissage" et la courbe "Seuil de d√©tection des anomalies" est de 0.16. Il n'y a pas de raisons que ce seuil soit identique entre les diff√©rents indices de v√©g√©tations. Modifiez ce seuil en rajoutant le param√®tre <code>threshold_anomaly = 0.12</code> √† la fonction <code>decline_detection</code> :</p>
<div class="codehilite"><pre><span></span><code>decline_detection<span class="o">(</span><span class="nv">data_directory</span> <span class="o">=</span> data_directory, <span class="nv">threshold_anomaly</span> <span class="o">=</span> <span class="m">0</span>.12<span class="o">)</span>
</code></pre></div>

<p>Essayez diff√©rents seuils, observez les r√©sultats. Plus ce seuil est √©lev√©, moins la d√©tection est sensible. Il y a un juste milieu √† trouver afin de d√©tecter les d√©perissements le plus pr√©cocement possible, en √©vitant les faux positifs.</p>
<h3 id="changer-de-zone-detude">Changer de zone d'√©tude</h3>
<p>A partir du m√™me script, nous allons maintenant faire tourner l'algorithme sur une deuxi√®me zone d'√©tude, celle-ci situ√©e en Meuse et dont les premi√®res attaques de scolytes sont d√©j√† anciennes.</p>
<ul>
<li>Pour ce faire, modifiez "ZoneEtude" dans les param√®tres <strong>input_directory</strong>, <strong>data_directory</strong> et <strong>shape_path</strong> en "ZoneEtude2", afin de donner le chemin des donn√©es li√©es √† cette zone :</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="nv">input_directory</span> <span class="o">=</span> <span class="s2">&quot;D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/RASTER/SERIES_SENTINEL/ZoneEtude2&quot;</span>
<span class="nv">data_directory</span> <span class="o">=</span> <span class="s2">&quot;D:/Documents/Deperissement/FORMATION_SANTE_FORETS/C_RESULTS/ZoneEtude2&quot;</span>
<span class="nv">shape_path</span> <span class="o">=</span> <span class="s2">&quot;D:/Documents/Deperissement/FORMATION_SANTE_FORETS/A_DATA/VECTOR/ZONE_ETUDE/ZoneEtude2.shp&quot;</span>
</code></pre></div>

<ul>
<li>Utilisez les param√®tres de votre choix parmi ceux modifi√©s pr√©cedemment</li>
<li>Relancez le script</li>
</ul>
<p>Prenez le temps d'observer les r√©sultats du timelapse et des s√©ries temporelles. Vous pourrez remarquer que cette zone, non situ√©e dans la zone de chevauchement entre orbites, dispose d'un nombre de dates plus faible que la zone pr√©cedente. Pour certains pixels, des dates entre 2018-01-01 et 2018-06-01 sont utilis√©es dans l'apprentissage afin d'atteindre le nombre de 10 dates valides. Vous pouvez ouvrir le raster DataModel/first_detection_date_index.tif dans QGIS pour constater qu'√† la diff√©rence de la zone d'√©tude pr√©c√©dente, il y a effectivements des diff√©rences de premi√®re date utilis√©e pour la d√©tection.</p>
<h2 id="exporter-des-resultats-adaptes-a-ses-besoins">Exporter des r√©sultats adapt√©s √† ses besoins</h2>
<p>Les timelapses cr√©es pour visualiser les r√©sultats jusqu'ici ne peuvent pas √™tre r√©alis√©s √† grande √©chelle. Pour sortir des r√©sultats √† l'√©chelle de tuiles enti√®res qui soient utilisables facilement par les utilisateurs, il existe une cinqui√®me √©tape qui permet d'exporter les r√©sultats sous forme de shapefile au pas de temps souhait√©. Vous pouvez retrouver le <a href="https://gitlab.com/raphael.dutrieux/fordead_package/-/blob/master/docs/user_guides/05_export_results.md">guide d'utilisation de cette √©tape</a>.</p>
<p>Pour effectuer cette √©tape, ajouter au script :
- Pour importer la fonction</p>
<div class="codehilite"><pre><span></span><code>from fordead.steps.step5_export_results import export_results
</code></pre></div>

<ul>
<li>Pour lancer la fonction</li>
</ul>
<div class="codehilite"><pre><span></span><code>export_results<span class="o">(</span>
    <span class="nv">data_directory</span> <span class="o">=</span> data_directory,
    <span class="nv">start_date</span> <span class="o">=</span> <span class="s2">&quot;2015-05-23&quot;</span>,
    <span class="nv">end_date</span> <span class="o">=</span> <span class="s2">&quot;2022-05-23&quot;</span>,
    <span class="nv">frequency</span><span class="o">=</span> <span class="s2">&quot;M&quot;</span>,
    <span class="nv">export_soil</span> <span class="o">=</span> True,
    <span class="nv">multiple_files</span> <span class="o">=</span> False
    <span class="o">)</span>
</code></pre></div>

<ul>
<li>Mettez en commentaire les fonctions de visualisation pour √©viter leurs temps de calcul en rajoutant # au d√©but de leurs lignes.</li>
</ul>
<p>Puis, relancez le script depuis l'invit√© de commande :</p>
<div class="codehilite"><pre><span></span><code>python detection_scolytes.py
</code></pre></div>

<p>Les r√©sultats sont dans le dossier Results, importez les dans QGIS, ajoutez une symbologie <strong>Cat√©goris√©e</strong> √† partir du champ "period".
- Dans le shapefile periodic_results_decline, les polygones contiennent la p√©riode √† laquelle la premi√®re anomalie a √©t√© d√©tect√© pour les zones d√©p√©rissantes.
- Dans le shapefile periodic_results_soil, les polygones contiennent la p√©riode √† laquelle la premi√®re anomalie de sol a √©t√© d√©tect√© pour les zones d√©tect√©es comme sol nu/coupe.
Explorez ces r√©sultats et assurez vous de bien les comprendre. </p>
<p>Ensuite, supprimez ces r√©sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront √©cras√©s par la suite.</p>
<p>Essayez un param√®trage diff√©rent en modifiant <code>multiple_files = False</code> en <code>multiple_files = True</code> avant de relancer le script. Dans le m√™me dossier, vous devriez trouver un shapefile par mois dont le nom  correspond √† la fin de chaque p√©riode, ils contiennent des polygones correspondant √† l'√©tat du peuplement √† la fin de la p√©riode, m√™me si les premi√®res anomalies ont lieu avant la date renseign√©e par le param√®tre <code>start_date</code>. L'√©tat peut √™tre Atteint, Coupe ou Coupe sanitaire.
Importez en quelques un entre 2018 et fin 2020 pour voir l'√©volution. Ajoutez une symbologie <strong>Cat√©goris√©e</strong> √† partir du champ "state". 
Vous pouvez copier le style d'une des couches aux autres couches.</p>
<p>Ensuite, supprimez ces r√©sultats de QGIS, puis sauvegardez les dans un dossier de sauvegarde si vous le souhaitez, car ils seront √©cras√©s par la suite.</p>
<p>Maintenant, modifiez le param√®tre <code>frequency</code>, ce param√®tre accepte des fr√©quences journali√®res ("D"), mensuelles ("M") ou annuelles ("A") ou des multiples ("15D" = jours, "3M" = trois mois...). Il est d√©conseill√© de mettre une p√©riode trop courte, puisqu'il faut qu'il y ait des dates SENTINEL-2 au sein de ces p√©riodes pour que les r√©sultats soient int√©ressants. Ce param√®tre accepte √©galement la valeur "sentinel", auquel cas chaque p√©riode correspond au temps entre chaque date SENTINEL-2 utilis√©e. Les p√©riodes ne sont donc pas de dur√©e constante, par exemple si <code>multiple_files = False</code>, alors on obtient un shapefile pour chaque date SENTINEL-2 utilis√©e. </p>
<p>Faites tourner le script en utilisant le param√®tre <code>frequency = "sentinel"</code>. Observez les r√©sultats.
Ensuite, prenez le temps d'essayer diff√©rents param√®tres de fr√©quences, avec <code>multiple_files = False</code> et <code>multiple_files = True</code>, trouvez les param√®tres qui vous semblent les plus adapt√©s, r√©flechissez aux am√©liorations que vous aimeriez voir, tout cela pourra nourrir la discussion autour des informations produites par la m√©thode et leur exploitation.</p>
<p>N'h√©sitez pas √©galement √† modifier des param√®tres plus en amont pour vous familiariser avec l'outil.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../02_pretraitement_classification/" title="02 Pretraitement Classification" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                02 Pretraitement Classification
              </span>
            </div>
          </a>
        
        
          <a href="../user_guides/00_installation/" title="00 Installation" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                00 Installation
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.2d1db4bd.min.js"></script>
      <script src="../../assets/javascripts/bundle.6627ddf3.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.5eca75d3.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS_HTML"></script>
      
    
  </body>
</html>